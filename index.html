<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>メダカの餌 一覧</title>

  <style>
    body{
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      padding: 20px;
      margin: 20px;
    }

    /* 説明ブロック：上下に並べる */
    .info-col{
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 10px 0 12px 0;
      max-width: 950px;
    }

    .info-box{
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 8px 10px;
      background: #fafafa;
    }

    .info-box summary{
      cursor: pointer;
      font-weight: 600;
      margin: 2px 0 6px 0;
    }

    .info-box ul{
      margin: 6px 0 0 18px;
      padding: 0;
    }

    #table-wrap{
      height: 80vh;
      overflow: auto;
      border: 1px solid #ccc;
      max-width: 950px;
    }

    #data-table{
      border-collapse: collapse;
      table-layout: fixed;
      width: 100%;
      font-size: 14px;
    }

    #data-table th,
    #data-table td{
      border: 1px solid #ccc;
      padding: 6px 8px;
      text-align: left;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    #data-table th{
      background: #f0f0f0;
      cursor: pointer;
      position: sticky;
      top: 0;
      z-index: 2;
    }

    #data-table th:hover{
      background: #e0e0e0;
    }

    /* 列幅 */
    #data-table th:nth-child(1),
    #data-table td:nth-child(1){ width: 230px; }

    #data-table th:nth-child(2),
    #data-table td:nth-child(2){ width: 105px; }

    #data-table th:nth-child(3),
    #data-table td:nth-child(3){ width: 55px; }

    #data-table th:nth-child(4),
    #data-table td:nth-child(4),
    #data-table th:nth-child(5),
    #data-table td:nth-child(5),
    #data-table th:nth-child(6),
    #data-table td:nth-child(6),
    #data-table th:nth-child(7),
    #data-table td:nth-child(7){ width: 55px; }

    #data-table th:nth-child(8),
    #data-table td:nth-child(8){ width: 150px; }

    /* スマホ対応 */
    @media (max-width: 768px){
      #table-wrap{
        overflow: auto;
      }

      #data-table th:nth-child(1),
      #data-table td:nth-child(1){
        position: sticky;
        left: 0;
        background: #fff;
        z-index: 3;
      }

      #data-table th{
        z-index: 4;
      }
    }
  </style>
</head>

<body>

<h1>
  メダカの餌一覧
  <span id="sortStatus" style="font-size:12px; margin-left:12px; color:#666;"></span>
</h1>

<div class="info-col">
  <!-- ★最初は折りたたみ：open を付けない -->
  <details class="info-box">
    <summary>この一覧の使い方</summary>
    <ul>
      <li>各成分をクリックすると並び替えできます</li>
      <li>ソート後、餌名またはメーカーをクリックすると初期配置に戻ります</li>
      <li>※ 数値は目安です。詳細は各公式情報をご確認ください</li>
    </ul>
  </details>

  <details class="info-box">
    <summary>餌の用途分類について</summary>
    <ul>
      <li><strong>主食</strong>：日常のローテーションの軸</li>
      <li><strong>育成</strong>：稚魚〜成長期向け</li>
      <li><strong>産卵</strong>：繁殖期のコンディション用</li>
      <li><strong>機能特化</strong>：色揚げ・消化など</li>
      <li><strong>補助</strong>：留守時など</li>
    </ul>
  </details>
</div>

<div id="table-wrap">
  <table id="data-table"></table>
</div>

<script>
const CSV_URL = "deta.csv";

let ALL_ROWS = [];
let ORIGINAL_ROWS = null;
let SORT_STATE = { col: -1, step: 0 };

function toNum(v){
  if (v == null) return NaN;
  const s = String(v).replace(/[%\s]/g, "");
  const n = parseFloat(s);
  return Number.isFinite(n) ? n : NaN;
}

function setStatus(text){
  const el = document.getElementById("sortStatus");
  if (el) el.textContent = text;
}

function renderTable(rows){
  const table = document.getElementById("data-table");
  table.innerHTML = "";

  rows.forEach((row, i)=>{
    const tr = document.createElement("tr");

    row.forEach((cell, j)=>{
      const el = document.createElement(i === 0 ? "th" : "td");

      if (j === 0 && i > 0){
        el.textContent = cell;
        el.style.color = "#007aff";
      } else {
        el.textContent = cell;
      }

      if (i === 0){
        el.onclick = ()=>sortTable(j);
      }

      tr.appendChild(el);
    });

    table.appendChild(tr);
  });
}

function resetToOriginal(){
  ALL_ROWS = JSON.parse(JSON.stringify(ORIGINAL_ROWS));
  SORT_STATE = { col: -1, step: 0 };
  renderTable(ALL_ROWS);
  setStatus("");
}

function sortTable(col){
  if (col === 0 || col === 1){
    resetToOriginal();
    return;
  }

  if (SORT_STATE.col !== col){
    SORT_STATE.col = col;
    SORT_STATE.step = 0;
  } else {
    SORT_STATE.step = (SORT_STATE.step + 1) % 2;
  }

  const desc = SORT_STATE.step === 0;
  const header = ALL_ROWS[0];
  const body = ALL_ROWS.slice(1);

  body.sort((a,b)=>{
    const na = toNum(a[col]);
    const nb = toNum(b[col]);
    if (!Number.isFinite(na)) return 1;
    if (!Number.isFinite(nb)) return -1;
    return desc ? nb - na : na - nb;
  });

  ALL_ROWS = [header, ...body];
  renderTable(ALL_ROWS);
  setStatus(`ソート：${header[col]} / ${desc ? "高い順" : "低い順"}`);
}

fetch(CSV_URL)
  .then(res=>res.text())
  .then(text=>{
    ALL_ROWS = text.trim().split("\n").map(r=>r.split(","));
    ORIGINAL_ROWS = JSON.parse(JSON.stringify(ALL_ROWS));
    renderTable(ALL_ROWS);
  });
</script>

</body>
</html>


